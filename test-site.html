<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PLS Site Functionality Test</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: white;
        padding: 20px;
        min-height: 100vh;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(135deg, #c5a059 0%, #ecd4a1 50%, #c5a059 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .subtitle {
        color: #94a3b8;
        margin-bottom: 30px;
      }
      .test-section {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(197, 160, 89, 0.2);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .test-section h2 {
        color: #c5a059;
        font-size: 1.3rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .test-item {
        background: rgba(0, 0, 0, 0.2);
        padding: 12px 15px;
        margin: 8px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 3px solid transparent;
      }
      .test-item.pass {
        border-left-color: #10b981;
      }
      .test-item.fail {
        border-left-color: #ef4444;
      }
      .test-item.pending {
        border-left-color: #f59e0b;
      }
      .status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: bold;
        text-transform: uppercase;
      }
      .status.pass {
        background: #10b981;
        color: white;
      }
      .status.fail {
        background: #ef4444;
        color: white;
      }
      .status.pending {
        background: #f59e0b;
        color: white;
      }
      .status.running {
        background: #3b82f6;
        color: white;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      button {
        background: linear-gradient(135deg, #c5a059 0%, #ecd4a1 50%, #c5a059 100%);
        color: #0f172a;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        margin: 10px 5px;
        transition: transform 0.2s;
      }
      button:hover {
        transform: scale(1.05);
      }
      button:active {
        transform: scale(0.95);
      }
      .summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }
      .summary-card {
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        border: 2px solid rgba(197, 160, 89, 0.3);
      }
      .summary-card .number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 5px;
      }
      .summary-card .label {
        color: #94a3b8;
        font-size: 0.9rem;
        text-transform: uppercase;
      }
      .error-details {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid #ef4444;
        padding: 10px;
        border-radius: 6px;
        margin-top: 8px;
        font-size: 0.85rem;
        color: #fca5a5;
        font-family: monospace;
      }
      .progress-bar {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 20px;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #c5a059, #ecd4a1);
        width: 0%;
        transition: width 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ PLS Site Functionality Test</h1>
      <p class="subtitle">Comprehensive testing suite for all site features</p>

      <div class="progress-bar">
        <div class="progress-fill" id="progressBar"></div>
      </div>

      <div class="summary">
        <div class="summary-card">
          <div class="number" id="totalTests">0</div>
          <div class="label">Total Tests</div>
        </div>
        <div class="summary-card">
          <div class="number" style="color: #10b981" id="passedTests">0</div>
          <div class="label">Passed</div>
        </div>
        <div class="summary-card">
          <div class="number" style="color: #ef4444" id="failedTests">0</div>
          <div class="label">Failed</div>
        </div>
        <div class="summary-card">
          <div class="number" style="color: #f59e0b" id="pendingTests">0</div>
          <div class="label">Pending</div>
        </div>
      </div>

      <div style="text-align: center; margin-bottom: 30px">
        <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
        <button onclick="location.reload()">üîÑ Reset</button>
        <button onclick="window.open('http://localhost:3000', '_blank')">üåê Open Site</button>
        <button onclick="window.open('http://localhost:3000/test-site.html', '_self')">
          üîó Open via Dev Server
        </button>
      </div>

      <div
        style="
          background: rgba(59, 130, 246, 0.1);
          border: 1px solid #3b82f6;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 20px;
        "
      >
        <p style="margin: 0; color: #93c5fd; font-size: 0.9rem; margin-bottom: 10px">
          ‚ÑπÔ∏è <strong>Note:</strong> For best results, open this page via the dev server at
          <a
            href="http://localhost:3000/test-site.html"
            style="color: #60a5fa; text-decoration: underline"
          >
            http://localhost:3000/test-site.html
          </a>
        </p>
        <p style="margin: 0; color: #93c5fd; font-size: 0.85rem">
          ‚è±Ô∏è Tests may take 1-2 minutes to complete as they wait for React to render the page.
        </p>
      </div>

      <div id="testResults"></div>
    </div>

    <script>
      const tests = {
        'Asset Loading': [
          { name: 'PLS Logo', test: () => checkImage('/images/pls-logo.png') },
          { name: 'ACCA Logo', test: () => checkImage('/images/partners/acca-logo.png') },
          { name: 'Montague Logo', test: () => checkImage('/images/partners/montague-logo.png') },
          {
            name: 'AQ Archers Logo',
            test: () => checkImage('/images/partners/aq-archers-logo.png'),
          },
          { name: 'CIOL Logo', test: () => checkImage('/images/partners/CIOL-logo.png') },
          { name: 'Pedro Photo', test: () => checkImage('/images/team/pedro.jpg') },
          { name: 'NoVo Avatar', test: () => checkImage('/images/services/avatar.png') },
          {
            name: 'NoVo Avatar Talking',
            test: () => checkImage('/images/services/avatar_speak.gif'),
          },
        ],
        'Page Structure': [
          { name: 'Main HTML loads', test: () => checkURL('http://localhost:3000') },
          { name: 'Header/Nav exists', test: () => checkElement('nav') },
          { name: 'Home section', test: () => checkElement('id="home"') },
          { name: 'Services section', test: () => checkElement('id="services"') },
          { name: 'Partners section', test: () => checkElement('id="partners"') },
          { name: 'About section', test: () => checkElement('id="about"') },
          { name: 'Translation section', test: () => checkElement('id="translation"') },
          { name: 'Contact section', test: () => checkElement('id="contact"') },
          { name: 'Footer exists', test: () => checkElement('footer') },
        ],
        'Interactive Elements': [
          { name: 'Language switcher', test: () => checkElement('EN/PT') },
          { name: 'NoVo AI button', test: () => checkElement('Ask NoVo') },
          {
            name: 'Service cards display',
            test: () => checkElement('Legal Services'),
          },
          {
            name: 'Partner logos display',
            test: () => checkElement('Montague'),
          },
          { name: 'Contact section exists', test: () => checkElement('Contact') },
        ],
        'API Integration': [
          { name: 'Gemini API configured', test: () => checkAPIConfig() },
          {
            name: 'Translation service',
            test: () => checkElement('id="translation"'),
          },
          {
            name: 'Image analysis feature',
            test: () => checkElement('id="analysis"'),
          },
          { name: 'AI Legal Advice', test: () => checkElement('id="ai-advice"') },
        ],
        'Responsive Design': [
          { name: 'Mobile viewport meta', test: () => checkMeta('viewport') },
          { name: 'Tailwind CSS loaded', test: () => checkElement('tailwindcss') },
          {
            name: 'Responsive layout',
            test: () => checkElement('max-w-7xl'),
          },
        ],
        Performance: [
          { name: 'CSS loaded', test: () => checkCSS() },
          { name: 'JavaScript loaded', test: () => checkJS() },
          { name: 'No console errors', test: () => checkConsoleErrors() },
        ],
      };

      let testResults = {};
      let stats = { total: 0, passed: 0, failed: 0, pending: 0 };

      // Helper functions
      function checkImage(src) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve({ success: true });
          img.onerror = () => reject({ success: false, error: 'Image failed to load' });
          img.src = src;
          setTimeout(() => reject({ success: false, error: 'Timeout' }), 5000);
        });
      }

      function checkURL(url) {
        return fetch(url)
          .then((res) =>
            res.ok ? { success: true } : { success: false, error: `HTTP ${res.status}` }
          )
          .catch((err) => ({ success: false, error: err.message }));
      }

      function checkElement(searchText) {
        return new Promise((resolve) => {
          // Create hidden iframe to load the actual React app
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = 'http://localhost:3000';

          iframe.onload = () => {
            setTimeout(() => {
              try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const html = iframeDoc.body.innerHTML;
                const hasElement = html.includes(searchText);

                document.body.removeChild(iframe);

                if (hasElement) {
                  resolve({ success: true });
                } else {
                  resolve({ success: false, error: `"${searchText}" not found in rendered page` });
                }
              } catch (err) {
                document.body.removeChild(iframe);
                resolve({ success: false, error: err.message });
              }
            }, 2000); // Wait 2 seconds for React to render
          };

          iframe.onerror = () => {
            document.body.removeChild(iframe);
            resolve({ success: false, error: 'Failed to load page' });
          };

          document.body.appendChild(iframe);
        });
      }

      function checkMeta(name) {
        return fetch('http://localhost:3000')
          .then((res) => res.text())
          .then((html) => {
            const hasMeta =
              html.includes(`name="${name}"`) ||
              html.includes(`name='${name}'`) ||
              html.includes('viewport');
            return hasMeta ? { success: true } : { success: false, error: 'Meta tag not found' };
          });
      }

      function checkResponsiveImages() {
        return Promise.resolve({ success: true });
      }

      function checkCSS() {
        return fetch('http://localhost:3000')
          .then((res) => res.text())
          .then((html) => {
            const hasCSS = html.includes('<style') || html.includes('.css');
            return hasCSS ? { success: true } : { success: false, error: 'No CSS found' };
          });
      }

      function checkJS() {
        return fetch('http://localhost:3000')
          .then((res) => res.text())
          .then((html) => {
            const hasJS = html.includes('<script') || html.includes('.js');
            return hasJS ? { success: true } : { success: false, error: 'No JavaScript found' };
          });
      }

      function checkConsoleErrors() {
        return Promise.resolve({ success: true });
      }

      function checkAPIConfig() {
        return fetch('http://localhost:3000')
          .then((res) => res.text())
          .then((html) => {
            const hasAPI =
              html.includes('gemini') || html.includes('API') || html.includes('GEMINI');
            return hasAPI
              ? { success: true }
              : { success: false, error: 'API config not detected' };
          });
      }

      // Render functions
      function renderTests() {
        const container = document.getElementById('testResults');
        container.innerHTML = '';

        Object.keys(tests).forEach((section) => {
          const sectionDiv = document.createElement('div');
          sectionDiv.className = 'test-section';
          sectionDiv.innerHTML = `<h2>${getIcon(section)} ${section}</h2>`;

          tests[section].forEach((test) => {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-item pending';
            testDiv.id = `test-${test.name.replace(/\s/g, '-')}`;
            testDiv.innerHTML = `
            <span>${test.name}</span>
            <span class="status pending">Pending</span>
          `;
            sectionDiv.appendChild(testDiv);
            stats.pending++;
          });

          container.appendChild(sectionDiv);
        });

        stats.total = stats.pending;
        updateStats();
      }

      function getIcon(section) {
        const icons = {
          'Asset Loading': 'üñºÔ∏è',
          'Page Structure': 'üèóÔ∏è',
          'Interactive Elements': 'üéØ',
          'API Integration': 'üîå',
          'Responsive Design': 'üì±',
          Performance: '‚ö°',
        };
        return icons[section] || '‚úì';
      }

      function updateStats() {
        document.getElementById('totalTests').textContent = stats.total;
        document.getElementById('passedTests').textContent = stats.passed;
        document.getElementById('failedTests').textContent = stats.failed;
        document.getElementById('pendingTests').textContent = stats.pending;

        const progress = stats.total > 0 ? ((stats.passed + stats.failed) / stats.total) * 100 : 0;
        document.getElementById('progressBar').style.width = progress + '%';
      }

      async function runAllTests() {
        stats = { total: stats.total, passed: 0, failed: 0, pending: stats.total };

        for (const section of Object.keys(tests)) {
          for (const test of tests[section]) {
            await runTest(test);
            // Longer delay for React rendering tests
            if (
              test.name.includes('section') ||
              test.name.includes('button') ||
              test.name.includes('display')
            ) {
              await sleep(500);
            } else {
              await sleep(100);
            }
          }
        }
      }

      async function runTest(test) {
        const testId = `test-${test.name.replace(/\s/g, '-')}`;
        const testDiv = document.getElementById(testId);
        const statusSpan = testDiv.querySelector('.status');

        testDiv.className = 'test-item';
        statusSpan.className = 'status running';

        // Show loading indicator for React tests
        if (
          test.name.includes('section') ||
          test.name.includes('button') ||
          test.name.includes('display')
        ) {
          statusSpan.textContent = 'Loading React...';
        } else {
          statusSpan.textContent = 'Running...';
        }

        try {
          const result = await test.test();

          if (result.success) {
            testDiv.className = 'test-item pass';
            statusSpan.className = 'status pass';
            statusSpan.textContent = 'Pass';
            stats.passed++;
          } else {
            throw new Error(result.error || 'Test failed');
          }
        } catch (error) {
          testDiv.className = 'test-item fail';
          statusSpan.className = 'status fail';
          statusSpan.textContent = 'Fail';

          const errorDiv = document.createElement('div');
          errorDiv.className = 'error-details';
          errorDiv.textContent = error.message || 'Unknown error';
          testDiv.appendChild(errorDiv);

          stats.failed++;
        }

        stats.pending--;
        updateStats();
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      // Initialize
      renderTests();
    </script>
  </body>
</html>
